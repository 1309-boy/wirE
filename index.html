<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wire Defense Game</title>
<style>
  :root{
    --wall: #555;   /* 벽 색 */
    --arena:#222;   /* 경기장 내부 */
    --page: #101010;
  }
  html,body{
    margin:0; height:100%;
    background:var(--page); color:#fff;
    font-family:system-ui, sans-serif;
    user-select:none; -webkit-user-select:none; overflow:hidden;
  }

  #app{
    height:100dvh;
    padding-bottom:env(safe-area-inset-bottom,0);
    display:flex; flex-direction:column;
  }

  #playArea{
    position:relative; flex:1;
    display:flex; align-items:center; justify-content:center;
    background:#181818;
  }

  /* 캔버스: CSS border 제거 → 벽은 JS로 직접 그림 */
  #gameCanvas{
    display:block;
    background:var(--arena);
  }

  #scoreDisplay{
    position:absolute; left:12px; top:12px; z-index:2;
    font-weight:700; font-size:20px; text-shadow:0 2px 4px rgba(0,0,0,.4);
  }

  /* 하단 중앙 D패드 */
  #joystickContainer{
    height:260px;
    display:grid;
    grid-template-columns:90px 90px 90px;
    grid-template-rows:90px 90px 90px;
    align-self:center;
    margin-bottom:calc(env(safe-area-inset-bottom,0) + 8px);
    touch-action:none;
  }
  .joyBtn,.joyEmpty{ width:90px; height:90px; }
  .joyBtn{
    border-radius:18px; background:#333; border:1px solid #666; color:#eee;
    display:flex; justify-content:center; align-items:center; font-size:30px;
  }
  .joyBtn:active{ background:#555; }
  .joyEmpty{ background:transparent; }
</style>
</head>
<body>
  <div id="app">
    <div id="playArea">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div id="scoreDisplay">점수: 0</div>
    </div>

    <div id="joystickContainer">
      <div class="joyEmpty"></div>            <div id="btnUp"    class="joyBtn">▲</div> <div class="joyEmpty"></div>
      <div id="btnLeft" class="joyBtn">◀</div><div class="joyEmpty"></div>              <div id="btnRight" class="joyBtn">▶</div>
      <div class="joyEmpty"></div>            <div id="btnDown"  class="joyBtn">▼</div> <div class="joyEmpty"></div>
    </div>
  </div>
<script>
(function(){
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('scoreDisplay');

  const state = {
    wirePoints: [],
    wireLine: null,
    score: 0
  };

  // --- 클릭 처리 ---
  canvas.addEventListener('mousedown', e=>{
    const rect = canvas.getBoundingClientRect();
    // client 좌표 → 캔버스 좌표 변환 (정수 반올림)
    const x = (e.clientX - rect.left) * (canvas.width / rect.width);
    const y = (e.clientY - rect.top)  * (canvas.height / rect.height);
    onWall(x,y);
  });

  canvas.addEventListener('touchstart', e=>{
    if(e.touches.length){
      const rect = canvas.getBoundingClientRect();
      const t = e.touches[0];
      const x = (t.clientX - rect.left) * (canvas.width / rect.width);
      const y = (t.clientY - rect.top)  * (canvas.height / rect.height);
      onWall(x,y);
    }
  });

  function onWall(x,y){
    // 벽 두께/클릭 허용 범위 크게 (30%로 테스트)
    const marginX = canvas.width * 0.3;
    const marginY = canvas.height * 0.3;

    let wx=x, wy=y, ok=false;
    if(x <= marginX){ wx=0; ok=true; }
    else if(x >= canvas.width - marginX){ wx=canvas.width; ok=true; }
    else if(y <= marginY){ wy=0; ok=true; }
    else if(y >= canvas.height - marginY){ wy=canvas.height; ok=true; }

    if(!ok) return;

    state.wirePoints.push({x:wx,y:wy});
    if(state.wirePoints.length>=2){
      const p1=state.wirePoints[0], p2=state.wirePoints[1];
      state.wireLine = {p1,p2};
      state.wirePoints.length=0;
      console.log("와이어 생성:", state.wireLine); // 디버그 로그
    }
  }

  // --- 그리기 테스트 ---
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#222"; ctx.fillRect(0,0,canvas.width,canvas.height);
    if(state.wireLine){
      ctx.strokeStyle="cyan"; ctx.lineWidth=4;
      ctx.beginPath();
      ctx.moveTo(state.wireLine.p1.x, state.wireLine.p1.y);
      ctx.lineTo(state.wireLine.p2.x, state.wireLine.p2.y);
      ctx.stroke();
    }
    requestAnimationFrame(draw);
  }
  draw();
})();
</script>
</body>
</html>
